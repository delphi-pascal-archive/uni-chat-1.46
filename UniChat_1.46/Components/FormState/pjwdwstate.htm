<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>

<head>
	<meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
	<title>DelphiDabbler Info Sheet: Window State Components</title>
	<base target="_blank">
	<style>
		<!--
		body {
			background-color: White;
			font-family: Verdana, Geneva, Arial, Helvetica, sans-serif;
			font-size: 10pt;
		}
		h1 {font-size: 12pt;}
		h2 {font-size: 10pt;}
		h3 {font-size: 10pt; font-style: italic;}
		h4 {font-size: 10pt; font-weight: normal; font-style: italic;}
		-->
	</style>
</head>

<body>


<h1>TPJWdwState &amp; TPJRegWdwState Components</h1>

<hr noshade />


<h2>Contents</h2>

<ul>
  <li><a href="#Description" target="_self">Description</a></li>
  <li><a href="#Compatibility" target="_self">Compatibility</a></li>
  <li><a href="#Installation" target="_self">Installation</a></li>
  <li><a href="#Issues" target="_self">Known Issues</a></li>
  <li><a href="#Update" target="_self">Update History</a></li>
  <li><a href="#Credits" target="_self">Credits</a></li>
  <li><a href="#License" target="_self">License and Disclaimer</a></li>
  <li><a href="#Author" target="_self">About the Author</a></li>
</ul>

<hr noshade />


<h2><a name="Description"></a>Description</h2>

<p>The file <code>PJWdwState.pas</code> includes two components -
	<em>TPJWdwState</em> and <em>TPJRegWdwState</em>.</p>

<p>The components can save the state (minimised, maximised or normal) of a form
  window, along with its size and position. <em>TPJWdwState</em> saves the
  information to an ini file while <em>TPJRegWdwState</em> saves to the
  registry. The components can also read information back and restore the saved
  window settings. This means the components can be used to restore a window to
  the condition it was in during some previous execution. This is acheived
  either by calling a couple of methods within code or setting the component to
  automatically save and restore the window on creation and destruction.</p>

<p>With <em>TPJWdwState</em> you can specify the name of the ini file, or let
	the component choose one. You can also decide the name of the section within
	the ini file that will be used. Again the component can provide a suitable
	default section name.</p>

<p>Similarly with <em>TPJRegWdwState</em> you can specify the registry root and
	sub-keys under which the information is saved. Again suitable default values
	are used if no keys are specified.</p>

<p>Also included in the <code>PJWdwState.pas</code> unit is the component
	<em>TPJCustomWdwState</em> along with a helper component. Neither of these
	components should be constructed directly and they are not registered with
	Delphi.</p>

<p>The zip file that contains <code>PJWdwState.pas</code> also contains an
	optional property editor in <code>PJHKeyPropEdit.pas</code>
	<em>(TPJHKEYPropEditor)</em> for editing the registry root key property of
	<em>TPJRegWindowState</em>.</p>

<hr noshade />


<h2><a name="Compatibility"></a>Compatibility</h2>

<p>The components and property editor have been tested with Delphi 4, 6 and 7.
	It is likely that they will work with Delphi 3 and 5, but this has not been
	tested. They are not compatible with Delphi 1 and 2.</p>

<hr noshade />


<h2><a name="Installation"></a>Installation</h2>

<p>In these instructions <code><strong>$(DELPHI)</strong></code> is to be taken
	to represent the path where the appropriate version of Delphi was installed.
	For example, if you have Delphi 4 installed on the default installation path
	then <code>$(DELPHI)</code> is equivalent to
	<code>C:\Program&nbsp;Files\Borland\Delphi4</code>.</p>

<p>To install, proceed as follows:</p>

<ol>
	<li>Unzip the <code>.zip</code> file containing the components into a
		folder, preserving the directory structure.</li>
	<li>Copy <code>PJWdwState.pas</code> and <code>PJWdwState.dcr</code> to the
		folder from where you wish to install the component into the Delphi
		Component Palette. This will probably be a sub-folder of the
		<code>$(DELPHI)\lib</code> folder.</li>
	<li>If you wish to install the optional HKEY component editor contained in
		<code>PJHKEYPropEdit.pas</code> then copy this file to the same
		folder as <code>PJWdwState.pas</code>.</li>
	<li>Install the components and, optionally, the property editor, by chosing
		the <em>Component | Install Component</em> menu option then:
		<ul>
			<li>Select the &quot;Into exisiting package&quot; page of the
				<em>Install Components</em> dialog box.</li>
			<li>Browse to the folder where you saved
				<code>PJWdwState.pas</code> and select the file.</li>
			<li>Select the package into which you wish to install the
				component.</li>
			<li>If installing the property editor, repeat the above process with
				<code>PJHKEYPropEdit.pas</code>.</li>
			<li>Accept that the package will be rebuilt.</li>
			<li>A dialog box should be displayed saying that
				<em>TPJWdwState</em> and <em>TPJRegWdwState</em> have been added
				to the component palette. If you have installed the property
				editor no confirmation of installation will be displayed.</li>
		</ul>
	</li>
	<li>You can now delete <code>PJWdwState.pas</code> (and
		<code>PJHKEYPropEdit.pas</code> if installed) from the place where you
		copied them if you wish. The components will appear on a palette called
		<em>DelphiDabbler</em>. You can move the components to a different
		palette as required.</li>
	<li>The simplest way to install the help file is to use my
		<a href="http://www.delphidabbler.com/chi"><em>Component Help Installer
		Expert</em></a>. To install manually, proceed as follows:
		<ul>
			<li>Copy <code>PJWdwState.hlp</code> to whichever folder you wish to
				install it to.</li>
			<li>In Delphi 3 to 6 (where X is the Delphi version 3..6):
				<ul>
					<li>Edit <code>DelphiX.ohl</code> (in
						<code>$(DELPHI)\Help</code>), adding the line
						<code>:Link PJWdwState.hlp</code> to the end of the
						section labelled &quot;Third party help&quot;.</li>
					<li>Edit <code>DelphiX.ohi</code> (in
						<code>$(DELPHI)\Help</code>), adding the line
						<code>:Index DelphiDabbler Window State
						Components=PJWdwState.hlp</code> towards the end of the
						index section.</li>
					<li>Edit <code>DelphiX.cnt</code> (in
						<code>$(DELPHI)\Help</code>), ensuring that the lines
						<code>:Include delphiX.ohi</code> and <code>:Include
						delphiX.ohl</code> appear somewhere in the file.</li>
				</ul>
			</li>
			<li>In Delphi 7:
				<ul>
					<li>Edit <code>D7.ohl</code> (in
						<code>$(DELPHI)\Help</code>), adding the line
						<code>:Link PJWdwState.hlp</code> to the end of the
						section labelled &quot;Third party help&quot;.</li>
					<li>Edit <code>D7.ohi</code> (in
						<code>$(DELPHI)\Help</code>), adding the line
						<code>:Index DelphiDabbler Window State
						Components=PJWdwState.hlp</code> towards the end of the
						index section.</li>
					<li>Edit <code>D7.cnt</code> (in
						<code>$(DELPHI)\Help</code>), ensuring that the lines
						<code>:Include d7.ohi</code> and
						<code>:Include d7.ohl</code> appear somewhere in the
						file.</li>
				</ul>
			</li>
			<li>Using <em>RegEdit</em> open the key
				<code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\Help</code> 
				and add a new string value named
				<code>PJWdwState.hlp</code> whose value is the path
				where you copied the help file (probably
				<code>($DELPHI)\Help</code>).</li>
		</ul>
	</li>
</ol>

<hr noshade />


<h2><a name="Issues"></a>Known Issues</h2>

<ul>
  <li>No known outstanding bugs.</li>
</ul>

<hr noshade />


<h2><a name="Update"></a>Update History</h2>

<p><strong>Release 4.2 of 30 October 2003</strong><br />
	<em>PJWdwState v4.1 of 30 October 2003<br />
	PJHKeyPropEdit v1.0.2 of 30 October 2003</em></p>
<ul>
	<li>Added new option to <strong>Options</strong> property to ensure window
		is not displayed out of the desktop's work area.</li>
	<li>Some changes made to way registry is accessed in
		<em>TPJRegWdwState</em>.</li>
	<li>Rearranged some decision logic.</li>
	<li>Changed component palette to 'DelphiDabbler' from 'PJSoft'.</li>
</ul>

<p><strong>Release 4.1 of 07 August 2002</strong><br />
	<em>PJWdwState v4.1 of 07 August 2002<br />
	PJHKeyPropEdit v1.0.1 of 08 October 2000</em></p>
<ul>
	<li>Added new <strong>OnReadWdwState</strong> event in which user can
		override window placement, size and state read from registry or ini
		file.</li>
	<li>Added new <strong>Options</strong> property which contains a set of
		values that govern the behavoiur of the component. The options are to
		ignore the stored window state and ensure window is displayed normally
		or ignore the stored window size and use the form's size as
		designed.</li>
</ul>

<p><strong>Release 4.0 of 17 March 2002</strong><br />
	PJWdwState v4.0 of 17 March 2002<br />
	PJHKeyPropEdit v1.0.1 of 08 October 2000</em></p>
<ul>
	<li>Made use ParamStr(0) for default name of ini file and registry key.</li>
	<li>Changed name of default registry sub key and ini file section to enable
		use of multiple forms without overwriting each other's data when using
		default property values.</li>
	<li>Rewrote method of auto saving and restoring windows to stop having to
		manipulate the owning form's <strong>OnCreate</strong> and
		<strong>OnDestroy</strong> event handlers. Now uses a hook class to hook
		into owning form's messages and pass them to window state components.
		The window now always momentarily appears in normal state before being
		maximized or minimized as required.</li>
	<li>Added new <strong>MinimizeDelay</strong> property to control how long
		the normal window appears before being minimized.</li>
	<li>Added <strong>OnGetIniData</strong> event to TPJWdwState and
		<strong>OnGetRegData</strong> events to <em>TPJRegWdwState</em> to allow
		user to override property values for reading / writing ini file and
		registry.</li>
	<li>Made so that now only one instance of a window state component can be
		placed on a form.</li>
	<li>Rationalised some elements of code.</li>
	<li>Changed component palette from 'PJ Stuff' to 'PJSoft'.</li>
	<li>Changed unit name to PJWdwState.</li>
	<li>Rewrote help file to integrate into Delphi 3+ IDE, removing support for
		Delphi 2 IDE..</li>
</ul>


<p><strong>Release 3.1.1 of 08 October 2000</strong><br />
	<em>WdwState v3.1 of 29 April 2000<br />
	PJHKeyPropEdit v1.0.1 of 08 October 2000</em></p>
<ul>
	<li>Added property editor for <em>TPJRegWdwState's</em>
		<strong>RegRootKey</strong> property.</li>
</ul>


<p><strong>Release 3.1 of 29 April 2000</strong><br />
	<em>WdwState v3.1 of 29 April 2000</em></p>
<ul>
	<li>Fixed a bug where windows that were supposed to be restored maximised to
		be displayed using the last saved window dimensions. This bug was also
		causing the form to fail to load other components under certain
		circumstances. (thanks to Andre Viol for reporting these bugs).</li>
</ul>

<p><strong>Release 3.0 of 05 April 2000</strong><br />
	<em>WdwState v3.0 of 05 April 2000</em> 
<ul>
	<li>Added <strong>AutoSaveRestore</strong> property to enable forms to be
		automatically savedand restored (thanks to Stefan Winter for suggesting
		this and providing prototype code).</li>
	<li>Modified window restoration code to avoid task bars in positions other
		than bottom of screen (again thanks to Stefan for pointing out the
		problem and providing prototype code to fix it).</li>
	<li>Prevented forms being restored as minimized from flashing on screen (by
	    cheating!)</li>
	<li>Removed conditional compilation statements since this version will not
		compile under Delphi 1.</li>
</ul>

<p><strong>Release 2.1 of 29 November 1999</strong><br />
	<em>WdwState v2.1 of 29 November 1999</em></p>
<ul>
	<li>Renamed <strong>ReadState</strong> and <strong>SaveState</strong>
		methods to <strong>ReadWdwState</strong> and
		<strong>SaveWdwState</strong> respectively since <code>ReadState</code>
		was masking a method inherited from <em>TComponent</em>.</li>
	<li>Updated HTML documentation to include installation notes for Delphi 3/4
		and added update history.</li>
</ul>

<p><strong>Release 2.0 of 19 October 1999</strong><br />
	<em>WdwState v2.0 of 19 October 1999</em></p>
<ul>
	<li>Re-write which added <em>TPJRegWdwState</em> component that stores
		window state information in registry.</li>
	<li>Extracted common functionality of <em>TPJWdwState</em> and
		<em>TPJRegWdwState</em> into new abstract base class
		<em>TPJCustomWdwState</em>.</li>
	<li><em>TPJWdwState</em> presented same interface and functionality as
		version 1.</li>
	<li><em>TRegWdwState</em> was not available when compiled under Delphi 1
		(because it uses the registry).</li>
	<li>Updated HTML documentation to deal with new classes.</li>
</ul>

<p><strong>Release 1.0 of 15 August 1999</strong><br />
	<em>WdwState v1.0 of 15 August 1999</em></p>
<ul>
	<li>Original version - included just <em>TPJWdwState</em> component with
		HTML documentation.</li>
</ul>

<hr noshade />


<h2><a name="Credits"></a>Credits</h2>

<ul>
  <li>Thanks are due to <em>Stefan Winter</em> for providing some of the code of
  	version 2.2 and for adding a prototype version of the AutoSaveRestore
	property. Stefan also suggested adding the OnGetIniDate and OnGetRegData
	events - implmented in v4.0</li>
  <li><em>Andre Viol</em> suggested that the normal window should flash on
  	screen before minimizing and maximizing as required.</li>
</ul>

<hr noshade />


<h2><a name="License"></a>License &amp; Disclaimer</h2>

<p>These components are copyright &copy; P.D.Johnson, 1999-2003.</p>

<p>The source code and help files can be freely distributed on a not-for-profit
	basis providing that:</p>

<ol>
	<li>The source code is not altered.</li>
	<li>This readme file is distributed with it unchanged.</li>
</ol>

<p>By not-for-profit I mean that you may recover out of pocket expenses
	incurred in distributing the code, but should not make a profit from
	this.</p>

<p>If you discover any bugs in this implementation, or if you have any update 
	suggestions, please contact me
	<a href="http://www.delphidabbler.com/contact.php">via my website</a>.</p>

<p>Please do modify the code for you own use. I'd like to see any changes you
	make - I could incorporate them into future versions. Please notify me of
	changes on at the above e-mail address.</p>

<p>This software is provided as is - no warranty is given as to its suitability
	for any purposes to which you may wish to put it.</p>

<hr noshade />


<h2><a name="Author"></a>About the Author</h2>

<p>I'm Peter Johnson - a hobbyist programmer living in Ceredigion in West Wales,
	UK. I write mainly in Delphi. My programs are available for download on my
	web-site:
	<a href="http://www.delphidabbler.com/">http://www.delphidabbler.com/</a>.
	</p>

<p>I can be contacted <a href="http://www.delphidabbler.com/contact.php">via the
	website</a>.</p>


</body>

</html>